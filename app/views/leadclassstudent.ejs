<!DOCTYPE html>
<html lang="en">
<head>
  <title>lead class student</title>
  <%- include('partials/head') %>
  <script src="/javascripts/Chart.min.js"></script>
</head>
<body>
  <%- include('partials/header') %>

  <div class="container-fluid bg-1">
    <h2 class="text-center">Student report</h2>
    <hr>

    <!--navs for tab-->
    <div id="tab-nav">
      <ul class="nav nav-pills custom-nav">
        <li class="active"><a href="#details" data-toggle="tab">Personal info</a></li>
        <li><a href="#performance" data-toggle="tab">Performance</a></li>
      </ul>
    </div>
  </div>

  <!--content for tabs-->
  <div class="tab-content bg-1">
    <!--personal info-->
    <div class="tab-pane active in fade text-center" id="details">
      <h3 class="text-center text-uppercase">Student Information</h3>

      <div class="details">
        <%for (key in info.personalInfo) {%>
        <p><span class="personal-info-title"><%= key %></span><span class="personal-info-seperator"> : </span><span
                  class="personal-info-value"><%= info.personalInfo[key] %></span></p>
        <%}%>
      </div>

      <a href="/interactions/teacher/<%=info.personalInfo['register_id']%>" class="btn btn-primary btn-block">View parent/guardian comments</a>
    </div>

    <!--performance-->
    <div class="tab-pane fade" id="performance">
      <!--add charts to the document-->
      <%Object.keys(info.allStudentInfo).slice(0, -1).forEach(key => {%>

      <div class="row">
        <h4>Overall performance in <%= key %></h4>

        <div class="col-md-4 col-md-offset-4 col-xs-12 col-sm-4 col-sm-offset-4">
          <canvas id="<%= key %>" width="400" height="400"></canvas>
        </div>
      </div>

      <script>
          let ctx_<%=key%> = document.getElementById('<%= key %>').getContext('2d');
          let data_<%=key%> = [];
          let labels_<%=key%> = [];
          <% info.allStudentInfo[key].forEach((val, ind) => {%>
          data_<%=key%>.push(<%=val%>);
          labels_<%=key%>.push(<%=info.allStudentInfo['emp_id'][ind]%>);
          <%})%>

          let graph_<%=key%> = new Chart(ctx_<%=key%>, {
              type: 'bar',
              data: {
                  labels: labels_<%=key%>,
                  datasets: [{
                      label: 'marks in <%=key%>',
                      data: data_<%=key%>,
                      borderWidth: 1,
                      backgroundColor: '#ffa74d'
                  }]
              },

              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero:true
                          }
                      }]
                  },
                  responsive: false,
                  maintainAspectRatio: true
              }
          });
      </script>

      <%});%>

      <div class="row">
        <h4>Attendance</h4>

        <div class="col-md-4 col-md-offset-4 col-xs-12 col-sm-4 col-sm-offset-4">
          <canvas id="attendance" width="400" height="400"></canvas>
        </div>
      </div>

      <script>
          var ctx_attendance = document.getElementById('attendance').getContext('2d');

          var pie_attendance = new Chart(ctx_attendance, {
              type: 'pie',
              data: {
                  labels: ['attended classes', 'missed classes'],
                  datasets: [{
                      data: [<%=info.attendance['attended']%>, <%=info.attendance['total'] -
                            info.attendance['attended']%>],
                      backgroundColor: ['#ff6767', '#67ff88'],
                      borderWidth: 1
                  }]
              },
              options: {
                  responsive: false,
                  maintainAspectRatio: true
              }
          })
      </script>
    </div>
  </div>

  <%- include("partials/scripts") %>
</body>
</html>